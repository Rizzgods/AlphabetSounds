{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>ğŸ² Alphabet Adventure Game!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=FREE"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bubblegum+Sans&family=Fredoka+One&display=swap" rel="stylesheet">
    <style>
        * {
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        html, body {
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
        }
        body {
            font-family: 'Bubblegum Sans', cursive;
            padding-bottom: env(safe-area-inset-bottom);
        }
        .title-font {
            font-family: 'Fredoka One', cursive;
        }
        @keyframes bounce-custom {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        @keyframes wiggle {
            0%, 100% { transform: rotate(-3deg); }
            50% { transform: rotate(3deg); }
        }
        @keyframes dice-roll {
            0% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(90deg) scale(1.2); }
            50% { transform: rotate(180deg) scale(1); }
            75% { transform: rotate(270deg) scale(1.2); }
            100% { transform: rotate(360deg) scale(1); }
        }
        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
        @keyframes rainbow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
        }
        .animate-bounce-custom {
            animation: bounce-custom 2s infinite;
        }
        .animate-wiggle {
            animation: wiggle 0.5s infinite;
        }
        .animate-dice-roll {
            animation: dice-roll 0.5s ease-in-out;
        }
        .animate-pop {
            animation: pop 0.3s ease-in-out;
        }
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
        .rainbow-bg {
            background: linear-gradient(124deg, #ff2400, #e81d1d, #e8b71d, #e3e81d, #1de840, #1ddde8, #2b1de8, #dd00f3, #dd00f3);
            background-size: 400% 400%;
            animation: rainbow 8s ease infinite;
        }
        .letter-tile {
            transition: all 0.3s ease;
        }
        .letter-tile:hover {
            transform: scale(1.1) rotate(5deg);
        }
        .player-marker {
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.5rem;
            z-index: 10;
            filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.3));
        }
        @media (min-width: 640px) {
            .player-marker {
                top: -15px;
                font-size: 1.8rem;
            }
        }
        .confetti {
            position: fixed;
            pointer-events: none;
            z-index: 1000;
        }
        .dice-btn:active {
            transform: scale(0.95);
        }
        .current-tile {
            box-shadow: 0 0 20px 5px rgba(255, 215, 0, 0.8);
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-pink-300 via-purple-300 to-indigo-400">
    <!-- Floating Decorations - Hidden on mobile for cleaner look -->
    <div class="hidden sm:block fixed top-10 left-10 text-6xl animate-bounce-custom opacity-60 pointer-events-none">ğŸŒŸ</div>
    <div class="hidden sm:block fixed top-20 right-20 text-5xl animate-bounce-custom opacity-60 pointer-events-none" style="animation-delay: 0.5s;">ğŸˆ</div>
    <div class="hidden sm:block fixed bottom-32 left-16 text-5xl animate-bounce-custom opacity-60 pointer-events-none" style="animation-delay: 1s;">ğŸ¦‹</div>
    <div class="hidden sm:block fixed bottom-20 right-16 text-6xl animate-bounce-custom opacity-60 pointer-events-none" style="animation-delay: 1.5s;">ğŸŒˆ</div>
    <div class="hidden md:block fixed top-1/2 left-5 text-4xl animate-float opacity-50 pointer-events-none">â­</div>
    <div class="hidden md:block fixed top-1/3 right-8 text-4xl animate-float opacity-50 pointer-events-none" style="animation-delay: 1s;">ğŸ€</div>

    <!-- Header -->
    <header class="text-center py-4 sm:py-6 md:py-8">
        <h1 class="title-font text-2xl sm:text-4xl md:text-6xl lg:text-7xl text-white drop-shadow-lg mb-1 sm:mb-2 md:mb-4 px-2">
            ğŸ² Alphabet Adventure! ğŸ²
        </h1>
        <p class="text-base sm:text-lg md:text-2xl text-white/90 drop-shadow px-2">
            Roll the dice and learn your ABCs! ğŸ‰
        </p>
    </header>

    <!-- Game Container -->
    <div class="container mx-auto px-2 sm:px-3 md:px-4 pb-6 max-w-6xl">
        <!-- Game Stats & Controls -->
        <div class="bg-white/95 backdrop-blur rounded-2xl sm:rounded-3xl shadow-2xl p-3 sm:p-4 md:p-6 mb-4 sm:mb-6 border-4 border-yellow-400">
            <!-- Mobile: Dice button prominent at top -->
            <div class="flex flex-col gap-3 sm:gap-4">
                <!-- Dice Section - Always centered and prominent -->
                <div class="flex flex-col items-center gap-2 sm:gap-3">
                    <button id="diceBtn" 
                            class="dice-btn bg-gradient-to-br from-red-400 to-red-600 hover:from-red-500 hover:to-red-700 
                                   text-white text-xl sm:text-2xl md:text-3xl font-bold py-4 sm:py-5 md:py-6 px-10 sm:px-12 md:px-14 rounded-2xl 
                                   shadow-lg hover:shadow-xl transform active:scale-95
                                   transition-all duration-200 border-4 border-white
                                   flex items-center gap-2 sm:gap-3 cursor-pointer min-h-[60px]">
                        <span id="diceIcon" class="text-3xl sm:text-4xl md:text-5xl">ğŸ²</span>
                        <span class="title-font">ROLL!</span>
                    </button>
                    <div class="bg-yellow-100 rounded-xl px-4 sm:px-5 md:px-6 py-2 border-2 border-yellow-400">
                        <p class="text-base sm:text-lg md:text-xl text-center">
                            You rolled: <span id="diceResult" class="title-font text-xl sm:text-2xl md:text-3xl text-red-500">-</span>
                        </p>
                    </div>
                </div>
                
                <!-- Stats Row -->
                <div class="flex justify-between items-center gap-2 sm:gap-4">
                    <!-- Player Info -->
                    <div class="flex items-center gap-2 sm:gap-3 flex-1">
                        <div class="text-3xl sm:text-4xl md:text-5xl animate-float">ğŸ§’</div>
                        <div class="min-w-0">
                            <p class="text-xs sm:text-sm md:text-lg text-purple-600 font-bold">Position</p>
                            <p class="text-lg sm:text-2xl md:text-3xl title-font text-pink-500 truncate" id="currentLetter">START ğŸ</p>
                        </div>
                    </div>

                    <!-- Score -->
                    <div class="text-center bg-gradient-to-br from-green-400 to-green-500 p-2 sm:p-3 md:p-4 rounded-xl sm:rounded-2xl shadow-lg flex-shrink-0">
                        <p class="text-white text-xs sm:text-sm md:text-base">Steps</p>
                        <p class="title-font text-2xl sm:text-xl sm:text-2xl md:text-4xl text-white" id="totalSteps">0</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Alphabet Board -->
        <div class="bg-white/95 backdrop-blur rounded-2xl sm:rounded-3xl shadow-2xl p-2 sm:p-4 md:p-6 border-4 border-green-400 mb-4 sm:mb-6">
            <h2 class="title-font text-lg sm:text-2xl md:text-3xl text-center text-purple-600 mb-2 sm:mb-4 md:mb-6">ğŸŒˆ The Alphabet Path ğŸŒˆ</h2>
            
            <!-- Game Board Grid - Optimized for mobile -->
            <div class="grid grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-9 gap-1.5 sm:gap-2 md:gap-3" id="gameBoard">
                <!-- Start Tile -->
                <div class="relative letter-tile bg-gradient-to-br from-green-400 to-green-500 rounded-lg sm:rounded-xl md:rounded-2xl p-2 sm:p-3 md:p-5 text-center shadow-lg border-2 sm:border-3 md:border-4 border-white cursor-pointer current-tile"
                     data-position="-1" id="tile-start">
                    <span class="player-marker" id="player-start">ğŸš€</span>
                    <span class="text-xl sm:text-2xl md:text-4xl">ğŸ</span>
                    <p class="text-[10px] sm:text-xs md:text-base text-white font-bold mt-0.5 sm:mt-1">START</p>
                </div>
                
                <!-- Alphabet Tiles A-Z -->
                <div class="relative letter-tile bg-gradient-to-br from-red-400 to-red-500 rounded-lg sm:rounded-xl md:rounded-2xl p-2 sm:p-3 md:p-5 text-center shadow-lg border-2 sm:border-3 md:border-4 border-white cursor-pointer"
                     data-position="0" data-letter="A" id="tile-0">
                    <span class="player-marker hidden" id="player-0">ğŸš€</span>
                    <span class="title-font text-2xl sm:text-2xl sm:text-2xl sm:text-3xl md:text-5xl text-white drop-shadow">A</span>
                    <p class="text-base sm:text-lg md:text-2xl mt-0.5 sm:mt-1">ğŸŠ</p>
                </div>
                <div class="relative letter-tile bg-gradient-to-br from-orange-400 to-orange-500 rounded-lg sm:rounded-xl md:rounded-2xl p-2 sm:p-3 md:p-5 text-center shadow-lg border-2 sm:border-3 md:border-4 border-white cursor-pointer"
                     data-position="1" data-letter="B" id="tile-1">
                    <span class="player-marker hidden" id="player-1">ğŸš€</span>
                    <span class="title-font text-2xl sm:text-2xl sm:text-2xl sm:text-3xl md:text-5xl text-white drop-shadow">B</span>
                    <p class="text-base sm:text-lg md:text-2xl mt-0.5 sm:mt-1">ğŸ»</p>
                </div>
                <div class="relative letter-tile bg-gradient-to-br from-yellow-400 to-yellow-500 rounded-xl md:rounded-2xl p-3 md:p-5 text-center shadow-lg border-3 md:border-4 border-white cursor-pointer"
                     data-position="2" data-letter="C" id="tile-2">
                    <span class="player-marker hidden" id="player-2">ğŸš€</span>
                    <span class="title-font text-2xl sm:text-2xl sm:text-3xl md:text-5xl text-white drop-shadow">C</span>
                    <p class="text-base sm:text-lg md:text-2xl mt-0.5 sm:mt-1">ğŸ±</p>
                </div>
                <div class="relative letter-tile bg-gradient-to-br from-lime-400 to-lime-500 rounded-xl md:rounded-2xl p-3 md:p-5 text-center shadow-lg border-3 md:border-4 border-white cursor-pointer"
                     data-position="3" data-letter="D" id="tile-3">
                    <span class="player-marker hidden" id="player-3">ğŸš€</span>
                    <span class="title-font text-2xl sm:text-2xl sm:text-3xl md:text-5xl text-white drop-shadow">D</span>
                    <p class="text-base sm:text-lg md:text-2xl mt-0.5 sm:mt-1">ğŸ•</p>
                </div>
                <div class="relative letter-tile bg-gradient-to-br from-green-400 to-green-500 rounded-xl md:rounded-2xl p-3 md:p-5 text-center shadow-lg border-3 md:border-4 border-white cursor-pointer"
                     data-position="4" data-letter="E" id="tile-4">
                    <span class="player-marker hidden" id="player-4">ğŸš€</span>
                    <span class="title-font text-2xl sm:text-2xl sm:text-3xl md:text-5xl text-white drop-shadow">E</span>
                    <p class="text-base sm:text-lg md:text-2xl mt-0.5 sm:mt-1">ğŸ˜</p>
                </div>
                <div class="relative letter-tile bg-gradient-to-br from-teal-400 to-teal-500 rounded-xl md:rounded-2xl p-3 md:p-5 text-center shadow-lg border-3 md:border-4 border-white cursor-pointer"
                     data-position="5" data-letter="F" id="tile-5">
                    <span class="player-marker hidden" id="player-5">ğŸš€</span>
                    <span class="title-font text-2xl sm:text-2xl sm:text-3xl md:text-5xl text-white drop-shadow">F</span>
                    <p class="text-base sm:text-lg md:text-2xl mt-0.5 sm:mt-1">ğŸ¦Š</p>
                </div>
                <div class="relative letter-tile bg-gradient-to-br from-cyan-400 to-cyan-500 rounded-xl md:rounded-2xl p-3 md:p-5 text-center shadow-lg border-3 md:border-4 border-white cursor-pointer"
                     data-position="6" data-letter="G" id="tile-6">
                    <span class="player-marker hidden" id="player-6">ğŸš€</span>
                    <span class="title-font text-2xl sm:text-2xl sm:text-3xl md:text-5xl text-white drop-shadow">G</span>
                    <p class="text-base sm:text-lg md:text-2xl mt-0.5 sm:mt-1">ğŸ¦’</p>
                </div>
                <div class="relative letter-tile bg-gradient-to-br from-blue-400 to-blue-500 rounded-xl md:rounded-2xl p-3 md:p-5 text-center shadow-lg border-3 md:border-4 border-white cursor-pointer"
                     data-position="7" data-letter="H" id="tile-7">
                    <span class="player-marker hidden" id="player-7">ğŸš€</span>
                    <span class="title-font text-2xl sm:text-2xl sm:text-3xl md:text-5xl text-white drop-shadow">H</span>
                    <p class="text-base sm:text-lg md:text-2xl mt-0.5 sm:mt-1">ğŸ¦›</p>
                </div>
                <div class="relative letter-tile bg-gradient-to-br from-indigo-400 to-indigo-500 rounded-xl md:rounded-2xl p-3 md:p-5 text-center shadow-lg border-3 md:border-4 border-white cursor-pointer"
                     data-position="8" data-letter="I" id="tile-8">
                    <span class="player-marker hidden" id="player-8">ğŸš€</span>
                    <span class="title-font text-2xl sm:text-2xl sm:text-3xl md:text-5xl text-white drop-shadow">I</span>
                    <p class="text-base sm:text-lg md:text-2xl mt-0.5 sm:mt-1">ğŸ¦</p>
                </div>
                <div class="relative letter-tile bg-gradient-to-br from-purple-400 to-purple-500 rounded-xl md:rounded-2xl p-3 md:p-5 text-center shadow-lg border-3 md:border-4 border-white cursor-pointer"
                     data-position="9" data-letter="J" id="tile-9">
                    <span class="player-marker hidden" id="player-9">ğŸš€</span>
                    <span class="title-font text-2xl sm:text-2xl sm:text-3xl md:text-5xl text-white drop-shadow">J</span>
                    <p class="text-base sm:text-lg md:text-2xl mt-0.5 sm:mt-1">ğŸ†</p>
                </div>
                <div class="relative letter-tile bg-gradient-to-br from-pink-400 to-pink-500 rounded-xl md:rounded-2xl p-3 md:p-5 text-center shadow-lg border-3 md:border-4 border-white cursor-pointer"
                     data-position="10" data-letter="K" id="tile-10">
                    <span class="player-marker hidden" id="player-10">ğŸš€</span>
                    <span class="title-font text-2xl sm:text-2xl sm:text-3xl md:text-5xl text-white drop-shadow">K</span>
                    <p class="text-base sm:text-lg md:text-2xl mt-0.5 sm:mt-1">ğŸ¨</p>
                </div>
                <div class="relative letter-tile bg-gradient-to-br from-rose-400 to-rose-500 rounded-xl md:rounded-2xl p-3 md:p-5 text-center shadow-lg border-3 md:border-4 border-white cursor-pointer"
                     data-position="11" data-letter="L" id="tile-11">
                    <span class="player-marker hidden" id="player-11">ğŸš€</span>
                    <span class="title-font text-2xl sm:text-2xl sm:text-3xl md:text-5xl text-white drop-shadow">L</span>
                    <p class="text-base sm:text-lg md:text-2xl mt-0.5 sm:mt-1">ğŸ¦</p>
                </div>
                <div class="relative letter-tile bg-gradient-to-br from-red-400 to-red-500 rounded-xl md:rounded-2xl p-3 md:p-5 text-center shadow-lg border-3 md:border-4 border-white cursor-pointer"
                     data-position="12" data-letter="M" id="tile-12">
                    <span class="player-marker hidden" id="player-12">ğŸš€</span>
                    <span class="title-font text-2xl sm:text-2xl sm:text-3xl md:text-5xl text-white drop-shadow">M</span>
                    <p class="text-base sm:text-lg md:text-2xl mt-0.5 sm:mt-1">ğŸ’</p>
                </div>
                <div class="relative letter-tile bg-gradient-to-br from-orange-400 to-orange-500 rounded-xl md:rounded-2xl p-3 md:p-5 text-center shadow-lg border-3 md:border-4 border-white cursor-pointer"
                     data-position="13" data-letter="N" id="tile-13">
                    <span class="player-marker hidden" id="player-13">ğŸš€</span>
                    <span class="title-font text-2xl sm:text-2xl sm:text-3xl md:text-5xl text-white drop-shadow">N</span>
                    <p class="text-base sm:text-lg md:text-2xl mt-0.5 sm:mt-1">ğŸ¦</p>
                </div>
                <div class="relative letter-tile bg-gradient-to-br from-amber-400 to-amber-500 rounded-xl md:rounded-2xl p-3 md:p-5 text-center shadow-lg border-3 md:border-4 border-white cursor-pointer"
                     data-position="14" data-letter="O" id="tile-14">
                    <span class="player-marker hidden" id="player-14">ğŸš€</span>
                    <span class="title-font text-2xl sm:text-2xl sm:text-3xl md:text-5xl text-white drop-shadow">O</span>
                    <p class="text-base sm:text-lg md:text-2xl mt-0.5 sm:mt-1">ğŸ¦‰</p>
                </div>
                <div class="relative letter-tile bg-gradient-to-br from-yellow-400 to-yellow-500 rounded-xl md:rounded-2xl p-3 md:p-5 text-center shadow-lg border-3 md:border-4 border-white cursor-pointer"
                     data-position="15" data-letter="P" id="tile-15">
                    <span class="player-marker hidden" id="player-15">ğŸš€</span>
                    <span class="title-font text-2xl sm:text-2xl sm:text-3xl md:text-5xl text-white drop-shadow">P</span>
                    <p class="text-base sm:text-lg md:text-2xl mt-0.5 sm:mt-1">ğŸ¦œ</p>
                </div>
                <div class="relative letter-tile bg-gradient-to-br from-lime-400 to-lime-500 rounded-xl md:rounded-2xl p-3 md:p-5 text-center shadow-lg border-3 md:border-4 border-white cursor-pointer"
                     data-position="16" data-letter="Q" id="tile-16">
                    <span class="player-marker hidden" id="player-16">ğŸš€</span>
                    <span class="title-font text-2xl sm:text-2xl sm:text-3xl md:text-5xl text-white drop-shadow">Q</span>
                    <p class="text-base sm:text-lg md:text-2xl mt-0.5 sm:mt-1">ğŸ¦</p>
                </div>
                <div class="relative letter-tile bg-gradient-to-br from-green-400 to-green-500 rounded-xl md:rounded-2xl p-3 md:p-5 text-center shadow-lg border-3 md:border-4 border-white cursor-pointer"
                     data-position="17" data-letter="R" id="tile-17">
                    <span class="player-marker hidden" id="player-17">ğŸš€</span>
                    <span class="title-font text-2xl sm:text-2xl sm:text-3xl md:text-5xl text-white drop-shadow">R</span>
                    <p class="text-base sm:text-lg md:text-2xl mt-0.5 sm:mt-1">ğŸ°</p>
                </div>
                <div class="relative letter-tile bg-gradient-to-br from-emerald-400 to-emerald-500 rounded-xl md:rounded-2xl p-3 md:p-5 text-center shadow-lg border-3 md:border-4 border-white cursor-pointer"
                     data-position="18" data-letter="S" id="tile-18">
                    <span class="player-marker hidden" id="player-18">ğŸš€</span>
                    <span class="title-font text-2xl sm:text-2xl sm:text-3xl md:text-5xl text-white drop-shadow">S</span>
                    <p class="text-base sm:text-lg md:text-2xl mt-0.5 sm:mt-1">ğŸ</p>
                </div>
                <div class="relative letter-tile bg-gradient-to-br from-teal-400 to-teal-500 rounded-xl md:rounded-2xl p-3 md:p-5 text-center shadow-lg border-3 md:border-4 border-white cursor-pointer"
                     data-position="19" data-letter="T" id="tile-19">
                    <span class="player-marker hidden" id="player-19">ğŸš€</span>
                    <span class="title-font text-2xl sm:text-2xl sm:text-3xl md:text-5xl text-white drop-shadow">T</span>
                    <p class="text-base sm:text-lg md:text-2xl mt-0.5 sm:mt-1">ğŸ¯</p>
                </div>
                <div class="relative letter-tile bg-gradient-to-br from-cyan-400 to-cyan-500 rounded-xl md:rounded-2xl p-3 md:p-5 text-center shadow-lg border-3 md:border-4 border-white cursor-pointer"
                     data-position="20" data-letter="U" id="tile-20">
                    <span class="player-marker hidden" id="player-20">ğŸš€</span>
                    <span class="title-font text-2xl sm:text-2xl sm:text-3xl md:text-5xl text-white drop-shadow">U</span>
                    <p class="text-base sm:text-lg md:text-2xl mt-0.5 sm:mt-1">ğŸ¦„</p>
                </div>
                <div class="relative letter-tile bg-gradient-to-br from-sky-400 to-sky-500 rounded-xl md:rounded-2xl p-3 md:p-5 text-center shadow-lg border-3 md:border-4 border-white cursor-pointer"
                     data-position="21" data-letter="V" id="tile-21">
                    <span class="player-marker hidden" id="player-21">ğŸš€</span>
                    <span class="title-font text-2xl sm:text-2xl sm:text-3xl md:text-5xl text-white drop-shadow">V</span>
                    <p class="text-base sm:text-lg md:text-2xl mt-0.5 sm:mt-1">ğŸ¦…</p>
                </div>
                <div class="relative letter-tile bg-gradient-to-br from-blue-400 to-blue-500 rounded-xl md:rounded-2xl p-3 md:p-5 text-center shadow-lg border-3 md:border-4 border-white cursor-pointer"
                     data-position="22" data-letter="W" id="tile-22">
                    <span class="player-marker hidden" id="player-22">ğŸš€</span>
                    <span class="title-font text-2xl sm:text-2xl sm:text-3xl md:text-5xl text-white drop-shadow">W</span>
                    <p class="text-base sm:text-lg md:text-2xl mt-0.5 sm:mt-1">ğŸº</p>
                </div>
                <div class="relative letter-tile bg-gradient-to-br from-indigo-400 to-indigo-500 rounded-xl md:rounded-2xl p-3 md:p-5 text-center shadow-lg border-3 md:border-4 border-white cursor-pointer"
                     data-position="23" data-letter="X" id="tile-23">
                    <span class="player-marker hidden" id="player-23">ğŸš€</span>
                    <span class="title-font text-2xl sm:text-2xl sm:text-3xl md:text-5xl text-white drop-shadow">X</span>
                    <p class="text-base sm:text-lg md:text-2xl mt-0.5 sm:mt-1">ğŸŸ</p>
                </div>
                <div class="relative letter-tile bg-gradient-to-br from-violet-400 to-violet-500 rounded-xl md:rounded-2xl p-3 md:p-5 text-center shadow-lg border-3 md:border-4 border-white cursor-pointer"
                     data-position="24" data-letter="Y" id="tile-24">
                    <span class="player-marker hidden" id="player-24">ğŸš€</span>
                    <span class="title-font text-2xl sm:text-2xl sm:text-3xl md:text-5xl text-white drop-shadow">Y</span>
                    <p class="text-base sm:text-lg md:text-2xl mt-0.5 sm:mt-1">ğŸƒ</p>
                </div>
                <div class="relative letter-tile bg-gradient-to-br from-purple-400 to-purple-500 rounded-xl md:rounded-2xl p-3 md:p-5 text-center shadow-lg border-3 md:border-4 border-white cursor-pointer"
                     data-position="25" data-letter="Z" id="tile-25">
                    <span class="player-marker hidden" id="player-25">ğŸš€</span>
                    <span class="title-font text-2xl sm:text-2xl sm:text-3xl md:text-5xl text-white drop-shadow">Z</span>
                    <p class="text-base sm:text-lg md:text-2xl mt-0.5 sm:mt-1">ğŸ¦“</p>
                </div>
                
                <!-- Finish Tile -->
                <div class="relative letter-tile rainbow-bg rounded-xl md:rounded-2xl p-3 md:p-5 text-center shadow-lg border-3 md:border-4 border-white cursor-pointer"
                     data-position="26" id="tile-finish">
                    <span class="player-marker hidden" id="player-finish">ğŸš€</span>
                    <span class="text-xl sm:text-2xl md:text-4xl">ğŸ†</span>
                    <p class="text-sm md:text-base text-white font-bold mt-1">WIN!</p>
                </div>
            </div>
        </div>

        <!-- Message Box -->
        <div id="messageBox" class="hidden bg-white/95 backdrop-blur rounded-3xl shadow-2xl p-6 md:p-8 border-4 border-pink-400 text-center mb-6">
            <p id="messageText" class="title-font text-2xl md:text-3xl text-purple-600"></p>
        </div>

        <!-- Instructions - Collapsible on mobile -->
        <details class="bg-white/95 backdrop-blur rounded-2xl sm:rounded-3xl shadow-2xl border-4 border-blue-400 group" open>
            <summary class="title-font text-lg sm:text-xl md:text-2xl text-center text-blue-600 p-3 sm:p-4 cursor-pointer list-none flex items-center justify-center gap-2">
                ğŸ“– How to Play <span class="text-sm group-open:rotate-180 transition-transform">â–¼</span>
            </summary>
            <div class="grid grid-cols-3 gap-1.5 sm:gap-2 md:gap-4 text-center p-2 sm:p-4 pt-0">
                <div class="bg-pink-100 rounded-lg sm:rounded-xl md:rounded-2xl p-2 sm:p-3 md:p-4">
                    <span class="text-xl sm:text-2xl md:text-4xl">1ï¸âƒ£</span>
                    <p class="text-xs sm:text-sm md:text-lg text-pink-600 mt-1">Tap ROLL!</p>
                </div>
                <div class="bg-yellow-100 rounded-lg sm:rounded-xl md:rounded-2xl p-2 sm:p-3 md:p-4">
                    <span class="text-xl sm:text-2xl md:text-4xl">2ï¸âƒ£</span>
                    <p class="text-xs sm:text-sm md:text-lg text-yellow-600 mt-1">Watch ğŸš€</p>
                </div>
                <div class="bg-green-100 rounded-lg sm:rounded-xl md:rounded-2xl p-2 sm:p-3 md:p-4">
                    <span class="text-xl sm:text-2xl md:text-4xl">3ï¸âƒ£</span>
                    <p class="text-xs sm:text-sm md:text-lg text-green-600 mt-1">Learn!</p>
                </div>
            </div>
        </details>
    </div>

    <!-- Footer -->
    <footer class="text-center py-3 sm:py-4 md:py-6">
        <p class="text-white/80 text-sm sm:text-base md:text-lg">ğŸ® Made with ğŸ’– for little learners! ğŸŒŸ</p>
    </footer>

    <!-- Letter Pop-up Modal -->
    <div id="letterModal" class="hidden fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-3 sm:p-4 overflow-y-auto">
        <div class="relative bg-gradient-to-br from-yellow-100 via-pink-100 to-purple-100 rounded-2xl sm:rounded-3xl p-4 sm:p-6 md:p-8 max-w-xs sm:max-w-md md:max-w-lg w-full mx-2 text-center transform animate-pop shadow-2xl border-4 border-yellow-400 my-4">
            <button id="closeLetterModal" class="absolute top-2 right-2 sm:top-3 sm:right-3 text-2xl sm:text-3xl text-gray-400 hover:text-gray-600 transition-colors cursor-pointer z-10">âœ–ï¸</button>
            
            <!-- Animal Image Display -->
            <div id="animalImageContainer" class="mb-4">
                <img id="animalImage" src="" alt="Animal" class="max-h-40 sm:max-h-48 md:max-h-56 mx-auto rounded-xl shadow-lg border-4 border-white">
            </div>
            
            <h2 id="letterTitle" class="title-font text-3xl sm:text-4xl md:text-5xl text-purple-600 mb-1"></h2>
            <p id="letterPhonetic" class="text-lg sm:text-xl md:text-2xl text-indigo-500 font-bold mb-1"></p>
            <p id="letterWord" class="text-lg sm:text-xl md:text-2xl text-pink-500 font-bold mb-3 sm:mb-4"></p>
            
            <!-- Letter Sound Button -->
            <div class="mb-4">
                <button id="playLetterSoundBtn" 
                        class="bg-gradient-to-r from-purple-400 to-pink-500 text-white text-sm sm:text-base md:text-lg font-bold py-2 sm:py-3 px-4 sm:px-6 rounded-full active:scale-95 transition-transform cursor-pointer shadow-lg">
                    ğŸ”¤ Letter Sound
                </button>
            </div>
            
            <!-- Animal Buttons -->
            <p class="text-sm sm:text-base text-gray-600 mb-2">Click an animal to see its picture!</p>
            <div id="animalButtonsContainer" class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3">
                <!-- Animal buttons will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <!-- Win Modal -->
    <div id="winModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-3 sm:p-4">
        <div class="bg-white rounded-2xl sm:rounded-3xl p-5 sm:p-6 md:p-8 max-w-sm sm:max-w-md w-full mx-2 text-center transform">
            <h2 class="title-font text-2xl sm:text-xl sm:text-2xl md:text-4xl text-purple-600 mb-3 sm:mb-4">ğŸ‰ YOU WIN! ğŸ‰</h2>
            <p class="text-4xl sm:text-5xl md:text-6xl mb-3 sm:mb-4">ğŸ†</p>
            <p class="text-base sm:text-lg md:text-xl text-gray-600 mb-4 sm:mb-5 md:mb-6">Amazing! You learned all 26 letters!</p>
            <button id="playAgainBtn" 
                    class="bg-gradient-to-r from-pink-500 to-purple-500 text-white text-base sm:text-lg md:text-xl font-bold py-3 sm:py-4 px-6 sm:px-8 rounded-full active:scale-95 transition-transform cursor-pointer w-full sm:w-auto">
                ğŸ”„ Play Again!
            </button>
        </div>
    </div>

    <script>
        // Game State
        let playerPosition = -1; // -1 = start position
        let totalSteps = 0;
        let isRolling = false;

        // DOM Elements
        const diceBtn = document.getElementById('diceBtn');
        const diceIcon = document.getElementById('diceIcon');
        const diceResult = document.getElementById('diceResult');
        const currentLetter = document.getElementById('currentLetter');
        const totalStepsEl = document.getElementById('totalSteps');
        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');
        const winModal = document.getElementById('winModal');
        const playAgainBtn = document.getElementById('playAgainBtn');

        // Letter Modal Elements
        const letterModal = document.getElementById('letterModal');
        const letterTitle = document.getElementById('letterTitle');
        const letterWord = document.getElementById('letterWord');
        const closeLetterModal = document.getElementById('closeLetterModal');
        const playLetterSoundBtn = document.getElementById('playLetterSoundBtn');
        const animalButtonsContainer = document.getElementById('animalButtonsContainer');
        const animalImageContainer = document.getElementById('animalImageContainer');
        const animalImage = document.getElementById('animalImage');
        let currentLetterData = null;

        // Alphabet data with multiple animals per letter
        const alphabet = [
            { letter: 'A', phonetic: '/Ã¦/', word: 'Alligator', emoji: 'ğŸŠ', animals: [
                { name: 'Alligator', image: 'Alligator.jpg', emoji: 'ğŸŠ' },
                { name: 'Antelope', image: 'Antelope.jpg', emoji: 'ğŸ¦Œ' },
                { name: 'Ape', image: 'Ape.jpg', emoji: 'ğŸ¦§' }
            ]},
            { letter: 'B', phonetic: '/b/', word: 'Bear', emoji: 'ğŸ»', animals: [
                { name: 'Bear', image: 'Bear.jpg', emoji: 'ğŸ»' },
                { name: 'Bat', image: 'Bat.jpg', emoji: 'ğŸ¦‡' },
                { name: 'Buffalo', image: 'Buffalo.jpg', emoji: 'ğŸƒ' }
            ]},
            { letter: 'C', phonetic: '/k/', word: 'Cat', emoji: 'ğŸˆ', animals: [
                { name: 'Cat', image: 'Cat.jpg', emoji: 'ğŸˆ' },
                { name: 'Cow', image: 'Cow.jpg', emoji: 'ğŸ„' },
                { name: 'Crocodile', image: 'Crocodile.jpg', emoji: 'ğŸŠ' }
            ]},
            { letter: 'D', phonetic: '/d/', word: 'Dog', emoji: 'ğŸ•', animals: [
                { name: 'Dog', image: 'Dog.jpg', emoji: 'ğŸ•' },
                { name: 'Dolphin', image: 'Dolphin.jpg', emoji: 'ğŸ¬' },
                { name: 'Deer', image: 'Deer.jpg', emoji: 'ğŸ¦Œ' }
            ]},
            { letter: 'E', phonetic: '/É›/', word: 'Elephant', emoji: 'ğŸ˜', animals: [
                { name: 'Elephant', image: 'Elephant.jpg', emoji: 'ğŸ˜' },
                { name: 'Eagle', image: 'Eagle.jpg', emoji: 'ğŸ¦…' },
                { name: 'Eel', image: 'Eel.jpg', emoji: 'ğŸ' }
            ]},
            { letter: 'F', phonetic: '/f/', word: 'Fox', emoji: 'ğŸ¦Š', animals: [
                { name: 'Fox', image: 'Fox.jpg', emoji: 'ğŸ¦Š' },
                { name: 'Frog', image: 'Frog.jpg', emoji: 'ğŸ¸' },
                { name: 'Fish', image: 'Fish.jpg', emoji: 'ğŸŸ' }
            ]},
            { letter: 'G', phonetic: '/g/', word: 'Giraffe', emoji: 'ğŸ¦’', animals: [
                { name: 'Giraffe', image: 'Giraffe.jpg', emoji: 'ğŸ¦’' },
                { name: 'Goat', image: 'Goat.jpg', emoji: 'ğŸ' },
                { name: 'Gorilla', image: 'Gorilla.jpg', emoji: 'ğŸ¦' }
            ]},
            { letter: 'H', phonetic: '/h/', word: 'Hippo', emoji: 'ğŸ¦›', animals: [
                { name: 'Hippo', image: 'Hippo.jpg', emoji: 'ğŸ¦›' },
                { name: 'Horse', image: 'Horse.jpg', emoji: 'ğŸ' },
                { name: 'Hamster', image: 'Hamster.jpg', emoji: 'ğŸ¹' }
            ]},
            { letter: 'I', phonetic: '/Éª/', word: 'Iguana', emoji: 'ğŸ¦', animals: [
                { name: 'Iguana', image: 'Iguana.jpg', emoji: 'ğŸ¦' },
                { name: 'Insect', image: 'Insects.jpg', emoji: 'ğŸ›' },
                { name: 'Impala', image: 'Impala.jpg', emoji: 'ğŸ¦Œ' }
            ]},
            { letter: 'J', phonetic: '/dÊ’/', word: 'Jaguar', emoji: 'ğŸ†', animals: [
                { name: 'Jaguar', image: 'Jaguar.jpg', emoji: 'ğŸ†' },
                { name: 'Jellyfish', image: 'Jellyfish.jpg', emoji: 'ğŸª¼' },
                { name: 'Jackal', image: 'Jackal.jpg', emoji: 'ğŸº' }
            ]},
            { letter: 'K', phonetic: '/k/', word: 'Koala', emoji: 'ğŸ¨', animals: [
                { name: 'Koala', image: 'Koala.jpg', emoji: 'ğŸ¨' },
                { name: 'Kangaroo', image: 'Kangaroo.jpg', emoji: 'ğŸ¦˜' },
                { name: 'Kingfisher', image: 'Kingfisher.jpg', emoji: 'ğŸ¦' }
            ]},
            { letter: 'L', phonetic: '/l/', word: 'Lion', emoji: 'ğŸ¦', animals: [
                { name: 'Lion', image: 'Lion.png', emoji: 'ğŸ¦' },
                { name: 'Leopard', image: 'Leopard.jpg', emoji: 'ğŸ†' },
                { name: 'Lizard', image: 'Lizard.png', emoji: 'ğŸ¦' }
            ]},
            { letter: 'M', phonetic: '/m/', word: 'Monkey', emoji: 'ğŸ’', animals: [
                { name: 'Monkey', image: 'Monkey.jpg', emoji: 'ğŸ’' },
                { name: 'Mouse', image: 'Mouse.jpg', emoji: 'ğŸ­' },
                { name: 'Moose', image: 'Moose.jpg', emoji: 'ğŸ«' }
            ]},
            { letter: 'N', phonetic: '/n/', word: 'Newt', emoji: 'ğŸ¦', animals: [
                { name: 'Newt', image: 'Newt.jpg', emoji: 'ğŸ¦' },
                { name: 'Narwhal', image: 'Narwhal.jpg', emoji: 'ğŸ³' },
                { name: 'Nightingale', image: 'Nightingale.jpg', emoji: 'ğŸ¦' }
            ]},
            { letter: 'O', phonetic: '/É’/', word: 'Owl', emoji: 'ğŸ¦‰', animals: [
                { name: 'Owl', image: 'Owl.jpg', emoji: 'ğŸ¦‰' },
                { name: 'Octopus', image: 'Octopus.jpg', emoji: 'ğŸ™' },
                { name: 'Ostrich', image: 'Ostrich.jpg', emoji: 'ğŸ¦¤' }
            ]},
            { letter: 'P', phonetic: '/p/', word: 'Parrot', emoji: 'ğŸ¦œ', animals: [
                { name: 'Parrot', image: 'Parrot.jpg', emoji: 'ğŸ¦œ' },
                { name: 'Penguin', image: 'Penguin.jpg', emoji: 'ğŸ§' },
                { name: 'Pig', image: 'Pig.jpg', emoji: 'ğŸ·' }
            ]},
            { letter: 'Q', phonetic: '/kw/', word: 'Quail', emoji: 'ğŸ¦', animals: [
                { name: 'Quail', image: 'Quail.jpg', emoji: 'ğŸ¦' },
                { name: 'Queen Bee', image: 'Queen_bee.jpg', emoji: 'ğŸ' },
                { name: 'Quokka', image: 'Quokka.jpg', emoji: 'ğŸ¹' }
            ]},
            { letter: 'R', phonetic: '/r/', word: 'Rabbit', emoji: 'ğŸ°', animals: [
                { name: 'Rabbit', image: 'Rabbit.jpg', emoji: 'ğŸ°' },
                { name: 'Raccoon', image: 'Raccoon.jpg', emoji: 'ğŸ¦' },
                { name: 'Rhinoceros', image: 'Rhinoceros.jpg', emoji: 'ğŸ¦' }
            ]},
            { letter: 'S', phonetic: '/s/', word: 'Snake', emoji: 'ğŸ', animals: [
                { name: 'Snake', image: 'Snake.jpg', emoji: 'ğŸ' },
                { name: 'Sheep', image: 'Sheep.jpg', emoji: 'ğŸ‘' },
                { name: 'Shark', image: 'Shark.jpg', emoji: 'ğŸ¦ˆ' }
            ]},
            { letter: 'T', phonetic: '/t/', word: 'Tiger', emoji: 'ğŸ…', animals: [
                { name: 'Tiger', image: 'Tiger.jpg', emoji: 'ğŸ…' },
                { name: 'Turtle', image: 'Turtle.jpg', emoji: 'ğŸ¢' },
                { name: 'Turkey', image: 'Turkey.jpg', emoji: 'ğŸ¦ƒ' }
            ]},
            { letter: 'U', phonetic: '/ÊŒ/', word: 'Unicorn', emoji: 'ğŸ¦„', animals: [
                { name: 'Unicorn', image: 'Unicorn.jpg', emoji: 'ğŸ¦„' },
                { name: 'Urchin', image: 'Urchin.jpg', emoji: 'ğŸª¸' },
                { name: 'Uakari', image: 'Uakari.jpg', emoji: 'ğŸµ' }
            ]},
            { letter: 'V', phonetic: '/v/', word: 'Vulture', emoji: 'ğŸ¦…', animals: [
                { name: 'Vulture', image: 'Vulture.jpg', emoji: 'ğŸ¦…' },
                { name: 'Vicuna', image: 'Vicuna.jpg', emoji: 'ğŸ¦™' },
                { name: 'Viper', image: 'Viper.jpg', emoji: 'ğŸ' }
            ]},
            { letter: 'W', phonetic: '/w/', word: 'Wolf', emoji: 'ğŸº', animals: [
                { name: 'Wolf', image: 'Wolf.jpg', emoji: 'ğŸº' },
                { name: 'Whale', image: 'Whale.jpg', emoji: 'ğŸ³' },
                { name: 'Worm', image: 'Worm.jpg', emoji: 'ğŸª±' }
            ]},
            { letter: 'X', phonetic: '/ks/', word: 'X-ray Fish', emoji: 'ğŸŸ', animals: [
                { name: 'X-ray Fish', image: 'X-ray_fish.jpg', emoji: 'ğŸŸ' },
                { name: 'Xenops', image: 'Xenops.jpg', emoji: 'ğŸ¦' },
                { name: 'Xantus Hummingbird', image: 'Xantus_Hummingbird.jpg', emoji: 'ğŸ¦' }
            ]},
            { letter: 'Y', phonetic: '/j/', word: 'Yak', emoji: 'ğŸƒ', animals: [
                { name: 'Yak', image: 'Yak.jpg', emoji: 'ğŸƒ' },
                { name: 'Yellowfin Tuna', image: 'Yellowfin_tuna.jpg', emoji: 'ğŸŸ' },
                { name: 'Yabby', image: 'Yabby.jpg', emoji: 'ğŸ¦' }
            ]},
            { letter: 'Z', phonetic: '/z/', word: 'Zebra', emoji: 'ğŸ¦“', animals: [
                { name: 'Zebra', image: 'Zebra.jpg', emoji: 'ğŸ¦“' },
                { name: 'Zebu', image: 'Zebu.jpg', emoji: 'ğŸ‚' },
                { name: 'Zorilla', image: 'Zorilla.jpg', emoji: 'ğŸ¦¨' }
            ]}
        ];

        // Dice faces for animation
        const diceFaces = ['âš€', 'âš', 'âš‚', 'âšƒ', 'âš„', 'âš…'];

        // Roll dice function
        function rollDice() {
            if (isRolling || playerPosition >= 26) return;
            isRolling = true;

            // Disable button during roll
            diceBtn.disabled = true;
            diceBtn.classList.add('opacity-75');

            // Animate dice
            diceIcon.classList.add('animate-dice-roll');
            
            // Show rolling animation
            let rollCount = 0;
            const rollInterval = setInterval(() => {
                diceResult.textContent = diceFaces[Math.floor(Math.random() * 6)];
                rollCount++;
                if (rollCount >= 10) {
                    clearInterval(rollInterval);
                    finishRoll();
                }
            }, 100);
        }

        function finishRoll() {
            // Get final dice value (1-6)
            const roll = Math.floor(Math.random() * 6) + 1;
            diceResult.textContent = roll;
            
            // Remove dice animation
            diceIcon.classList.remove('animate-dice-roll');
            
            // Update total steps
            totalSteps += roll;
            totalStepsEl.textContent = totalSteps;
            
            // Move player
            movePlayer(roll);
        }

        function movePlayer(steps) {
            const oldPosition = playerPosition;
            const targetPosition = Math.min(playerPosition + steps, 26); // Max is finish (26)

            // Animate movement step by step
            let currentStep = oldPosition;
            const moveInterval = setInterval(() => {
                currentStep++;
                if (currentStep > targetPosition) {
                    clearInterval(moveInterval);
                    playerPosition = targetPosition;
                    showMessage();
                    
                    // Re-enable button
                    setTimeout(() => {
                        diceBtn.disabled = false;
                        diceBtn.classList.remove('opacity-75');
                        isRolling = false;
                    }, 300);
                    return;
                }
                updatePlayerVisual(currentStep);
            }, 250);
        }

        function updatePlayerVisual(pos) {
            // Hide all player markers
            document.querySelectorAll('.player-marker').forEach(marker => {
                marker.classList.add('hidden');
            });

            // Remove highlight from all tiles
            document.querySelectorAll('.letter-tile').forEach(tile => {
                tile.classList.remove('current-tile', 'animate-wiggle');
            });

            // Show current position marker
            let markerId, tileId;
            if (pos === -1) {
                markerId = 'player-start';
                tileId = 'tile-start';
                currentLetter.textContent = 'START ğŸ';
            } else if (pos >= 26) {
                markerId = 'player-finish';
                tileId = 'tile-finish';
                currentLetter.textContent = 'ğŸ† WINNER!';
            } else {
                markerId = `player-${pos}`;
                tileId = `tile-${pos}`;
                currentLetter.textContent = `${alphabet[pos].letter} - ${alphabet[pos].emoji}`;
            }

            const marker = document.getElementById(markerId);
            if (marker) {
                marker.classList.remove('hidden');
            }

            const currentTile = document.getElementById(tileId);
            if (currentTile) {
                currentTile.classList.add('current-tile', 'animate-wiggle');
                // Scroll tile into view on mobile
                currentTile.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
            }
        }

        function showLetterPopup(letterData) {
            currentLetterData = letterData;
            
            // Update modal content
            letterTitle.textContent = letterData.letter;
            document.getElementById('letterPhonetic').textContent = `${letterData.letter} - ${letterData.phonetic}`;
            letterWord.textContent = `${letterData.letter} is for ${letterData.word}!`;
            letterWord.classList.remove('hidden');
            
            // Show first animal's image by default
            if (letterData.animals && letterData.animals.length > 0) {
                const firstAnimal = letterData.animals[0];
                const imagePath = "{% static 'animals/' %}" + encodeURIComponent(firstAnimal.image);
                animalImage.src = imagePath;
                animalImage.alt = firstAnimal.name;
            }
            
            // Create animal buttons
            animalButtonsContainer.innerHTML = '';
            if (letterData.animals) {
                letterData.animals.forEach(animal => {
                    const btn = document.createElement('button');
                    btn.className = 'bg-gradient-to-r from-green-400 to-blue-500 text-white text-sm sm:text-base font-bold py-2 sm:py-3 px-3 sm:px-4 rounded-xl active:scale-95 transition-transform cursor-pointer shadow-lg hover:from-green-500 hover:to-blue-600';
                    btn.innerHTML = `${animal.emoji} ${animal.name}`;
                    btn.addEventListener('click', () => showAnimal(animal, letterData.letter));
                    animalButtonsContainer.appendChild(btn);
                });
            }
            
            // Show modal
            letterModal.classList.remove('hidden');
            
            // Auto-play the letter pronunciation sound
            playLetterSound(letterData);
        }
        
        // Show animal image and speak animal name
        function showAnimal(animal, letter) {
            // Update the text to show clicked animal
            const letterData = alphabet.find(a => a.letter === letter);
            if (letterData) {
                document.getElementById('letterPhonetic').textContent = `${letter} - ${letterData.phonetic}`;
            }
            letterWord.textContent = `${letter} is for ${animal.name}!`;
            letterWord.classList.remove('hidden');
            
            // Display the animal image
            const imagePath = "{% static 'animals/' %}" + encodeURIComponent(animal.image);
            animalImage.src = imagePath;
            animalImage.alt = animal.name;
            
            // Speak the animal name
            speakAnimalName(animal.name, letter);
        }
        
        // Cache voices for mobile browsers
        let cachedVoices = [];
        
        // Load voices when available (needed for mobile)
        function loadVoices() {
            if ('speechSynthesis' in window) {
                cachedVoices = speechSynthesis.getVoices();
            }
        }
        
        // Initialize voices
        if ('speechSynthesis' in window) {
            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }
        
        // Speak animal name using TTS
        function speakAnimalName(animalName, letter) {
            stopAllAudio();
            
            const text = `${letter} is for ${animalName}!`;
            
            // Try ResponsiveVoice first (better mobile support)
            if (typeof responsiveVoice !== 'undefined' && responsiveVoice.voiceSupport()) {
                try {
                    responsiveVoice.speak(
                        text,
                        'US English Female',
                        {
                            pitch: 1.2,
                            rate: 0.85,
                            volume: 1
                        }
                    );
                    return;
                } catch (e) {
                    console.log('ResponsiveVoice error:', e);
                }
            }
            
            // Fallback to Web Speech API
            if ('speechSynthesis' in window) {
                // Cancel any pending speech
                speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                
                // Get voices (use cached or fetch fresh)
                let voices = cachedVoices.length > 0 ? cachedVoices : speechSynthesis.getVoices();
                
                // Find a suitable English voice
                const femaleVoice = voices.find(v => 
                    v.name.includes('Zira') || 
                    v.name.includes('Samantha') || 
                    v.name.includes('Female') ||
                    v.name.includes('Karen') ||
                    v.name.includes('Victoria') ||
                    v.name.includes('Google') && v.lang.startsWith('en')
                ) || voices.find(v => v.lang.startsWith('en')) || voices[0];
                
                if (femaleVoice) utterance.voice = femaleVoice;
                utterance.lang = 'en-US';
                utterance.rate = 0.85;
                utterance.pitch = 1.4;
                utterance.volume = 1;
                
                // Workaround for mobile browsers that pause speech
                const resumeSpeech = () => {
                    if (speechSynthesis.paused) {
                        speechSynthesis.resume();
                    }
                };
                
                utterance.onstart = () => {
                    // Keep speech alive on mobile
                    setTimeout(resumeSpeech, 100);
                };
                
                speechSynthesis.speak(utterance);
            }
        }

        // Audio element for playing letter sounds
        let letterAudio = null;

        // Stop any currently playing audio/speech
        function stopAllAudio() {
            if (letterAudio) {
                letterAudio.pause();
                letterAudio.currentTime = 0;
            }
            if (typeof responsiveVoice !== 'undefined') {
                responsiveVoice.cancel();
            }
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel();
            }
        }

        // Play letter pronunciation MP3 (e.g., the sound of the letter "A")
        function playLetterSound(letterData) {
            stopAllAudio();
            
            // Get the letter (some files are uppercase, some lowercase)
            const letter = letterData.letter;
            
            // Map letters to their correct filename case
            const filenameCaseMap = {
                'A': 'A', 'B': 'B', 'C': 'c', 'D': 'd', 'E': 'e', 'F': 'f',
                'G': 'g', 'H': 'h', 'I': 'i', 'J': 'j', 'K': 'k', 'L': 'L',
                'M': 'm', 'N': 'n', 'O': 'o', 'P': 'p', 'Q': 'q', 'R': 'r',
                'S': 's', 'T': 't', 'U': 'u', 'V': 'v', 'W': 'w', 'X': 'x',
                'Y': 'y', 'Z': 'z'
            };
            
            const filename = filenameCaseMap[letter] || letter.toLowerCase();
            const audioPath = "{% static 'sounds/' %}" + filename + ".mp3";
            
            letterAudio = new Audio(audioPath);
            letterAudio.volume = 1.0;
            letterAudio.play().catch(error => {
                console.log('Audio playback failed:', error);
            });
        }
        
        // Speak the word using TTS (e.g., "A is for Alligator")
        function speakWord(letterData) {
            stopAllAudio();
            
            if (typeof responsiveVoice !== 'undefined' && responsiveVoice.voiceSupport()) {
                responsiveVoice.speak(
                    `${letterData.letter} is for ${letterData.word}!`,
                    'US English Female',
                    {
                        pitch: 1.2,
                        rate: 0.85,
                        volume: 1
                    }
                );
            } else if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(`${letterData.letter} is for ${letterData.word}!`);
                
                // Try to find a female voice
                const voices = speechSynthesis.getVoices();
                const femaleVoice = voices.find(v => 
                    v.name.includes('Zira') || 
                    v.name.includes('Samantha') || 
                    v.name.includes('Female') ||
                    v.name.includes('Karen') ||
                    v.name.includes('Victoria')
                ) || voices.find(v => v.lang.startsWith('en'));
                
                if (femaleVoice) utterance.voice = femaleVoice;
                utterance.rate = 0.85;
                utterance.pitch = 1.4;
                speechSynthesis.speak(utterance);
            }
        }

        function closeLetterPopup() {
            letterModal.classList.add('hidden');
            currentLetterData = null;
        }

        function showMessage() {
            if (playerPosition >= 26) {
                // Player won!
                setTimeout(() => {
                    winModal.classList.remove('hidden');
                    createConfetti();
                }, 300);
            } else if (playerPosition >= 0) {
                const letterData = alphabet[playerPosition];
                // Show letter popup instead of simple message
                showLetterPopup(letterData);
            }
        }

        function createConfetti() {
            const colors = ['#ff6b6b', '#4ecdc4', '#ffe66d', '#95e1d3', '#f38181', '#aa96da', '#fcbad3'];
            for (let i = 0; i < 80; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.top = '-20px';
                    confetti.style.width = (8 + Math.random() * 8) + 'px';
                    confetti.style.height = (8 + Math.random() * 8) + 'px';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
                    document.body.appendChild(confetti);

                    // Animate falling
                    const animation = confetti.animate([
                        { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
                        { transform: `translateY(100vh) rotate(${Math.random() * 720}deg)`, opacity: 0 }
                    ], {
                        duration: 2500 + Math.random() * 1500,
                        easing: 'ease-out'
                    });

                    animation.onfinish = () => confetti.remove();
                }, i * 30);
            }
        }

        function resetGame() {
            playerPosition = -1;
            totalSteps = 0;
            totalStepsEl.textContent = '0';
            diceResult.textContent = '-';
            winModal.classList.add('hidden');
            messageBox.classList.add('hidden');
            updatePlayerVisual(-1);
            isRolling = false;
            diceBtn.disabled = false;
            diceBtn.classList.remove('opacity-75');
        }

        // Event Listeners
        diceBtn.addEventListener('click', rollDice);
        playAgainBtn.addEventListener('click', resetGame);

        // Letter Modal Event Listeners
        closeLetterModal.addEventListener('click', closeLetterPopup);
        playLetterSoundBtn.addEventListener('click', () => {
            if (currentLetterData) {
                playLetterSound(currentLetterData);
            }
        });

        // Close modal when clicking outside
        letterModal.addEventListener('click', (e) => {
            if (e.target === letterModal) {
                closeLetterPopup();
            }
        });

        // Click on tiles to show popup and hear the letter
        document.querySelectorAll('.letter-tile[data-letter]').forEach(tile => {
            tile.addEventListener('click', () => {
                const letter = tile.dataset.letter;
                const letterData = alphabet.find(a => a.letter === letter);
                if (letterData) {
                    // Show popup with pronunciation
                    showLetterPopup(letterData);
                    
                    // Visual feedback on tile
                    tile.classList.add('animate-pop');
                    setTimeout(() => tile.classList.remove('animate-pop'), 300);
                }
            });
        });

        // Keyboard support - press space or enter to roll, Escape to close modal
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Escape') {
                closeLetterPopup();
            } else if ((e.code === 'Space' || e.code === 'Enter') && !letterModal.classList.contains('hidden')) {
                // If modal is open, say again on Space/Enter
                e.preventDefault();
                if (currentLetterData) {
                    playLetterSound(currentLetterData);
                }
            } else if (e.code === 'Space' || e.code === 'Enter') {
                e.preventDefault();
                rollDice();
            }
        });

        // Unlock audio on mobile (iOS Safari requires user interaction)
        let audioUnlocked = false;
        function unlockAudio() {
            if (audioUnlocked) return;
            
            // Initialize ResponsiveVoice on first touch
            if (typeof responsiveVoice !== 'undefined') {
                responsiveVoice.speak('', 'US English Female', { volume: 0 });
            }
            
            // Initialize Web Speech API
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance('');
                utterance.volume = 0;
                speechSynthesis.speak(utterance);
            }
            
            audioUnlocked = true;
            document.removeEventListener('touchstart', unlockAudio);
            document.removeEventListener('click', unlockAudio);
        }
        
        document.addEventListener('touchstart', unlockAudio, { once: true });
        document.addEventListener('click', unlockAudio, { once: true });

        // Initialize game
        updatePlayerVisual(-1);
    </script>
</body>
</html>
